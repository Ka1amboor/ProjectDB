# Система управления библиотекой

Этот проект представляет собой систему управления библиотекой, реализованную с использованием Flask, Flask-Login, Flask-SQLAlchemy и JWT для аутентификации. Система включает регистрацию и вход пользователей, управление ролями (администратор и читатель), управление книгами, отслеживание аренды, а также добавление отзывов и кэширование популярных книг. Backend контейнеризован с помощью Docker, с отдельными микросервисами для PostgreSQL, MongoDB, Redis и Flask-приложения.

## Особенности

- Регистрация и вход пользователей с аутентификацией JWT.
- Управление ролями доступа (администратор и читатель).
- Управление книгами (добавление, просмотр доступных книг).
- Отслеживание аренды книг.
- Добавление и просмотр отзывов к книгам (MongoDB).
- Кэширование популярных книг (Redis).
- Эндпоинт для обновления токена.
- Документация API с использованием Swagger.

## Эндпоинты

### Эндпоинты пользователя

- **Регистрация**: `POST /register/`
- **Вход**: `POST /login/`
- **Выход**: `POST /logout/`

### Эндпоинты книг

- **Панель управления**: `GET /dashboard/`  
  (список книг с кэшированием через Redis)
- **Добавить книгу**: `POST /add_book/`

### Эндпоинты аренды

- **Аренда книги**: `POST /rent_book/<int:book_id>/`

### Эндпоинты токенов

- **Обновить токен**: `POST /refresh/`

### Эндпоинты отзывов (MongoDB)

- **Добавить отзыв**: `POST /books/<int:book_id>/reviews/`
  - Добавление отзыва к книге.
  - Тело запроса:
    ```json
    {
      "username": "User",
      "text": "Отличная книга!",
      "rating": 5
    }
    ```

- **Просмотр отзывов**: `GET /books/<int:book_id>/reviews/`
  - Получение всех отзывов к конкретной книге.

## Технологии

- **Flask** — веб-фреймворк.
- **PostgreSQL** — реляционная база данных для пользователей и книг.
- **MongoDB** — NoSQL-база данных для хранения отзывов.
- **Redis** — in-memory хранилище для кэширования популярных книг.
- **JWT** — аутентификация.
- **Swagger (Flasgger)** — автоматическая документация API.

## Swagger

Swagger предоставляет интерактивную документацию, которая позволяет разработчикам легко понять и протестировать эндпоинты API. Интерфейс доступен по адресу: `http://localhost:5005/apidocs/`

## Настройка Docker

Проект использует Docker для контейнеризации всех компонентов. В `docker-compose.yml` определены следующие микросервисы:

1. **PostgreSQL** — для хранения данных о пользователях и книгах.
2. **MongoDB** — для отзывов.
3. **Redis** — для кэширования.
4. **Flask-приложение** — основной backend.

### Команды Docker

```bash
# Сборка образов
docker compose build

# Запуск контейнеров
docker compose up

# Остановка контейнеров
docker compose down
```

## Структура проекта

```
library-management-system/
│
├── app/
│   ├── __init__.py
│   ├── auth.py
│   ├── cache.py
│   ├── config.py
│   ├── models.py
│   ├── models_mongo.py
│   ├── routes.py
│   ├── serializers.py
│   └── utils.py
│
├── run.py
├── Dockerfile
├── docker-compose.yml
├── requirements.txt
└── README.md
```
